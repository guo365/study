<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from docs.openstack.org/newton/networking-guide/deploy-ovs-provider.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Jan 2017 11:04:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Open vSwitch: Provider networks</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="_static/sphinxmark.css" type="text/css" />
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="http://docs.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org/">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org/">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://ask.openstack.org/">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/videos/summits">Summit Videos</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
    <h2>Open vSwitch: Provider networks</h2>
  </div>
  <div class="docs-actions">
    
    <a href="deploy-ovs.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Open vSwitch mechanism driver"></i></a>
    
    
    <a href="deploy-ovs-selfservice.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Open vSwitch: Self-service networks"></i></a>
    
    <a id="logABugLink1" href="#" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2016-12-31 09:02</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index-2.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Open vSwitch: Provider networks</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#example-configuration">Example configuration</a><ul>
<li><a class="reference internal" href="#controller-node">Controller node</a></li>
<li><a class="reference internal" href="#compute-nodes">Compute nodes</a></li>
<li><a class="reference internal" href="#verify-service-operation">Verify service operation</a></li>
<li><a class="reference internal" href="#create-initial-networks">Create initial networks</a></li>
<li><a class="reference internal" href="#verify-network-operation">Verify network operation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#network-traffic-flow">Network traffic flow</a><ul>
<li><a class="reference internal" href="#north-south">North-south</a></li>
<li><a class="reference internal" href="#east-west-scenario-1-instances-on-the-same-network">East-west scenario 1: Instances on the same network</a></li>
<li><a class="reference internal" href="#east-west-scenario-2-instances-on-different-networks">East-west scenario 2: Instances on different networks</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="open-vswitch-provider-networks">
<span id="deploy-ovs-provider"></span><h1>Open vSwitch: Provider networks<a class="headerlink" href="#open-vswitch-provider-networks" title="Permalink to this headline">¶</a></h1>
<p>This architecture example provides layer-2 connectivity between instances
and the physical network infrastructure using VLAN (802.1q) tagging. It
supports one untagged (flat) network and up to 4095 tagged (VLAN) networks.
The actual quantity of VLAN networks depends on the physical network
infrastructure. For more information on provider networks, see
<a class="reference internal" href="intro-os-networking.html#intro-os-networking-provider"><span>Provider networks</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Linux distributions often package older releases of Open vSwitch that can
introduce issues during operation with the Networking service. We recommend
using at least the latest long-term stable (LTS) release of Open vSwitch
for the best experience and support from Open vSwitch. See
<a class="reference external" href="http://www.openvswitch.org/">http://www.openvswitch.org</a> for available releases and the
<a class="reference external" href="https://github.com/openvswitch/ovs/blob/master/INSTALL.md">installation instructions</a> for</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>One controller node with the following components:</p>
<ul class="simple">
<li>Two network interfaces: management and provider.</li>
<li>OpenStack Networking server service and ML2 plug-in.</li>
</ul>
<p>Two compute nodes with the following components:</p>
<ul class="simple">
<li>Two network interfaces: management and provider.</li>
<li>OpenStack Networking Open vSwitch (OVS) layer-2 agent, DHCP agent, metadata
agent, and any dependencies including OVS.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Larger deployments typically deploy the DHCP and metadata agents on a
subset of compute nodes to increase performance and redundancy. However,
too many agents can overwhelm the message bus. Also, to further simplify
any deployment, you can omit the metadata agent and use a configuration
drive to provide metadata to instances.</p>
</div>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<img alt="Provider networks using OVS - overview" src="_images/deploy-ovs-provider-overview.png" />
<p>The following figure shows components and connectivity for one untagged
(flat) network. In this particular case, the instance resides on the
same compute node as the DHCP agent for the network. If the DHCP agent
resides on another compute node, the latter only contains a DHCP namespace
with a port on the OVS integration bridge.</p>
<img alt="Provider networks using OVS - components and connectivity - one network" src="_images/deploy-ovs-provider-compconn1.png" />
<p>The following figure describes virtual connectivity among components for
two tagged (VLAN) networks. Essentially, all networks use a single OVS
integration bridge with different internal VLAN tags. The internal VLAN
tags almost always differ from the network VLAN assignment in the Networking
service. Similar to the untagged network case, the DHCP agent may reside on
a different compute node.</p>
<img alt="Provider networks using OVS - components and connectivity - multiple networks" src="_images/deploy-ovs-provider-compconn2.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These figures omit the controller node because it does not handle instance
network traffic.</p>
</div>
</div>
<div class="section" id="example-configuration">
<h2>Example configuration<a class="headerlink" href="#example-configuration" title="Permalink to this headline">¶</a></h2>
<p>Use the following example configuration as a template to deploy provider
networks in your environment.</p>
<div class="section" id="controller-node">
<h3>Controller node<a class="headerlink" href="#controller-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Install the Networking service components that provide the
<code class="docutils literal"><span class="pre">neutron-server</span></code> service and ML2 plug-in.</p>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">neutron.conf</span></code> file:</p>
<ul>
<li><p class="first">Configure common options:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span>[DEFAULT]
core_plugin = ml2
auth_strategy = keystone

[database]
...

[keystone_authtoken]
...

[nova]
...

[agent]
...
</pre></div>
</div>
<p>See the <a class="reference external" href="http://docs.openstack.org/">Installation Tutorials and Guides</a> and
<a class="reference external" href="http://docs.openstack.org/">Configuration Reference</a> for your OpenStack
release to obtain the appropriate additional configuration for the
<code class="docutils literal"><span class="pre">[DEFAULT]</span></code>, <code class="docutils literal"><span class="pre">[database]</span></code>, <code class="docutils literal"><span class="pre">[keystone_authtoken]</span></code>, <code class="docutils literal"><span class="pre">[nova]</span></code>, and
<code class="docutils literal"><span class="pre">[agent]</span></code> sections.</p>
</li>
<li><p class="first">Disable service plug-ins because provider networks do not require
any. However, this breaks portions of the dashboard that manage
the Networking service. See the
<a class="reference external" href="http://docs.openstack.org/project-install-guide/newton">Newton Install Tutorials and Guides</a> for more
information.</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">service_plugins</span> <span class="o">=</span>
</pre></div>
</div>
</li>
<li><p class="first">Enable two DHCP agents per network so both compute nodes can
provide DHCP service provider networks.</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">dhcp_agents_per_network</span> <span class="o">=</span> <span class="s">2</span>
</pre></div>
</div>
</li>
<li><p class="first">If necessary, <a class="reference internal" href="config-mtu.html#config-mtu"><span>configure MTU</span></a>.</p>
</li>
</ul>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">ml2_conf.ini</span></code> file:</p>
<ul>
<li><p class="first">Configure drivers and network types:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[ml2]</span>
<span class="na">type_drivers</span> <span class="o">=</span> <span class="s">flat,vlan</span>
<span class="na">tenant_network_types</span> <span class="o">=</span>
<span class="na">mechanism_drivers</span> <span class="o">=</span> <span class="s">openvswitch</span>
<span class="na">extension_drivers</span> <span class="o">=</span> <span class="s">port_security</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure network mappings:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[ml2_type_flat]</span>
<span class="na">flat_networks</span> <span class="o">=</span> <span class="s">provider</span>

<span class="k">[ml2_type_vlan]</span>
<span class="na">network_vlan_ranges</span> <span class="o">=</span> <span class="s">provider</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">tenant_network_types</span></code> option contains no value because the
architecture does not support self-service networks.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">provider</span></code> value in the <code class="docutils literal"><span class="pre">network_vlan_ranges</span></code> option lacks VLAN
ID ranges to support use of arbitrary VLAN IDs.</p>
</div>
</li>
</ul>
</li>
<li><p class="first">Populate the database.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> su -s /bin/sh -c <span class="s2">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span>
<span class="go">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron</span>
</pre></div>
</div>
</li>
<li><p class="first">Start the following services:</p>
<ul class="simple">
<li>Server</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="compute-nodes">
<h3>Compute nodes<a class="headerlink" href="#compute-nodes" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Install the Networking service OVS layer-2 agent, DHCP agent, and
metadata agent.</p>
</li>
<li><p class="first">Install OVS.</p>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">neutron.conf</span></code> file, configure common options:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span>[DEFAULT]
core_plugin = ml2
auth_strategy = keystone

[database]
...

[keystone_authtoken]
...

[nova]
...

[agent]
...
</pre></div>
</div>
<p>See the <a class="reference external" href="http://docs.openstack.org/">Installation Tutorials and Guides</a> and
<a class="reference external" href="http://docs.openstack.org/">Configuration Reference</a> for your OpenStack
release to obtain the appropriate additional configuration for the
<code class="docutils literal"><span class="pre">[DEFAULT]</span></code>, <code class="docutils literal"><span class="pre">[database]</span></code>, <code class="docutils literal"><span class="pre">[keystone_authtoken]</span></code>, <code class="docutils literal"><span class="pre">[nova]</span></code>, and
<code class="docutils literal"><span class="pre">[agent]</span></code> sections.</p>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">openvswitch_agent.ini</span></code> file, configure the OVS agent:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[ovs]</span>
<span class="na">bridge_mappings</span> <span class="o">=</span> <span class="s">provider:br-provider</span>

<span class="k">[securitygroup]</span>
<span class="na">firewall_driver</span> <span class="o">=</span> <span class="s">iptables_hybrid</span>
</pre></div>
</div>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">dhcp_agent.ini</span></code> file, configure the DHCP agent:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">interface_driver</span> <span class="o">=</span> <span class="s">openvswitch</span>
<span class="na">enable_isolated_metadata</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">force_metadata</span> <span class="o">=</span> <span class="s">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">force_metadata</span></code> option forces the DHCP agent to provide
a host route to the metadata service on <code class="docutils literal"><span class="pre">169.254.169.254</span></code>
regardless of whether the subnet contains an interface on a
router, thus maintaining similar and predictable metadata behavior
among subnets.</p>
</div>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">metadata_agent.ini</span></code> file, configure the metadata agent:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">nova_metadata_ip</span> <span class="o">=</span> <span class="s">controller</span>
<span class="na">metadata_proxy_shared_secret</span> <span class="o">=</span> <span class="s">METADATA_SECRET</span>
</pre></div>
</div>
<p>The value of <code class="docutils literal"><span class="pre">METADATA_SECRET</span></code> must match the value of the same option
in the <code class="docutils literal"><span class="pre">[neutron]</span></code> section of the <code class="docutils literal"><span class="pre">nova.conf</span></code> file.</p>
</li>
<li><p class="first">Start the following services:</p>
<ul class="simple">
<li>OVS</li>
</ul>
</li>
<li><p class="first">Create the OVS provider bridge <code class="docutils literal"><span class="pre">br-provider</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ovs-vsctl add-br br-provider
</pre></div>
</div>
</li>
<li><p class="first">Add the provider network interface as a port on the OVS provider
bridge <code class="docutils literal"><span class="pre">br-provider</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ovs-vsctl add-port br-provider PROVIDER_INTERFACE
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">PROVIDER_INTERFACE</span></code> with the name of the underlying interface
that handles provider networks. For example, <code class="docutils literal"><span class="pre">eth1</span></code>.</p>
</li>
<li><p class="first">Start the following services:</p>
<ul class="simple">
<li>OVS agent</li>
<li>DHCP agent</li>
<li>Metadata agent</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="verify-service-operation">
<h3>Verify service operation<a class="headerlink" href="#verify-service-operation" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Source the administrative project credentials.</p>
</li>
<li><p class="first">Verify presence and operation of the agents:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network agent list
<span class="go">+--------------------------------------+--------------------+----------+-------------------+-------+-------+---------------------------+</span>
<span class="go">| ID                                   | Agent Type         | Host     | Availability Zone | Alive | State | Binary                    |</span>
<span class="go">+--------------------------------------+--------------------+----------+-------------------+-------+-------+---------------------------+</span>
<span class="go">| 1236bbcb-e0ba-48a9-80fc-81202ca4fa51 | Metadata agent     | compute2 |                   | True  | UP    | neutron-metadata-agent    |</span>
<span class="go">| 457d6898-b373-4bb3-b41f-59345dcfb5c5 | Open vSwitch agent | compute2 |                   | True  | UP    | neutron-openvswitch-agent |</span>
<span class="go">| 71f15e84-bc47-4c2a-b9fb-317840b2d753 | DHCP agent         | compute2 | nova              | True  | UP    | neutron-dhcp-agent        |</span>
<span class="go">| a6c69690-e7f7-4e56-9831-1282753e5007 | Metadata agent     | compute1 |                   | True  | UP    | neutron-metadata-agent    |</span>
<span class="go">| af11f22f-a9f4-404f-9fd8-cd7ad55c0f68 | DHCP agent         | compute1 | nova              | True  | UP    | neutron-dhcp-agent        |</span>
<span class="go">| bcfc977b-ec0e-4ba9-be62-9489b4b0e6f1 | Open vSwitch agent | compute1 |                   | True  | UP    | neutron-openvswitch-agent |</span>
<span class="go">+--------------------------------------+--------------------+----------+-------------------+-------+-------+---------------------------+</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="create-initial-networks">
<h3>Create initial networks<a class="headerlink" href="#create-initial-networks" title="Permalink to this headline">¶</a></h3>
<p>The configuration supports one flat or multiple VLAN provider networks. For
simplicity, the following procedure creates one flat provider network.</p>
<ol class="arabic">
<li><p class="first">Source the administrative project credentials.</p>
</li>
<li><p class="first">Create a flat network.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network create --share --provider-physical-network provider <span class="se">\</span>
<span class="go">  --provider-network-type flat provider1</span>
<span class="go">+---------------------------+-----------+-</span>
<span class="go">| Field                     | Value     |</span>
<span class="go">+---------------------------+-----------+</span>
<span class="go">| admin_state_up            | UP        |</span>
<span class="go">| mtu                       | 1500      |</span>
<span class="go">| name                      | provider1 |</span>
<span class="go">| port_security_enabled     | True      |</span>
<span class="go">| provider:network_type     | flat      |</span>
<span class="go">| provider:physical_network | provider  |</span>
<span class="go">| provider:segmentation_id  | None      |</span>
<span class="go">| router:external           | Internal  |</span>
<span class="go">| shared                    | True      |</span>
<span class="go">| status                    | ACTIVE    |</span>
<span class="go">+---------------------------+-----------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">share</span></code> option allows any project to use this network. To limit
access to provider networks, see <a class="reference internal" href="config-rbac.html#config-rbac"><span>Role-Based Access Control (RBAC)</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To create a VLAN network instead of a flat network, change
<code class="docutils literal"><span class="pre">--provider:network_type</span> <span class="pre">flat</span></code> to <code class="docutils literal"><span class="pre">--provider-network-type</span> <span class="pre">vlan</span></code>
and add <code class="docutils literal"><span class="pre">--provider-segment</span></code> with a value referencing
the VLAN ID.</p>
</div>
</li>
<li><p class="first">Create a IPv4 subnet on the provider network.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack subnet create --subnet-range 203.0.113.0/24 --gateway 203.0.113.1 <span class="se">\</span>
<span class="go">  --network provider1 --allocation-pool start=203.0.113.11,end=203.0.113.250 \</span>
<span class="go">  --dns-nameserver 8.8.4.4 provider1-v4</span>
<span class="go">+-------------------+----------------------------+</span>
<span class="go">| Field             | Value                      |</span>
<span class="go">+-------------------+----------------------------+</span>
<span class="go">| allocation_pools  | 203.0.113.11-203.0.113.250 |</span>
<span class="go">| cidr              | 203.0.113.0/24             |</span>
<span class="go">| dns_nameservers   | 8.8.4.4                    |</span>
<span class="go">| enable_dhcp       | True                       |</span>
<span class="go">| gateway_ip        | 203.0.113.1                |</span>
<span class="go">| ip_version        | 4                          |</span>
<span class="go">| name              | provider1-v4               |</span>
<span class="go">+-------------------+----------------------------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Enabling DHCP causes the Networking service to provide DHCP which can
interfere with existing DHCP services on the physical network
infrastructure.</p>
</div>
</li>
<li><p class="first">Create a IPv6 subnet on the provider network.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack subnet create --subnet-range fd00:203:0:113::/64 --gateway fd00:203:0:113::1 <span class="se">\</span>
<span class="go">  --ip-version 6 --ipv6-address-mode slaac --network provider1 \</span>
<span class="go">  --dns-nameserver 2001:4860:4860::8844 provider1-v6</span>
<span class="go">+-------------------+------------------------------------------------------+</span>
<span class="go">| Field             | Value                                                |</span>
<span class="go">+-------------------+------------------------------------------------------+</span>
<span class="go">| allocation_pools  | fd00:203:0:113::2-fd00:203:0:113:ffff:ffff:ffff:ffff |</span>
<span class="go">| cidr              | fd00:203:0:113::/64                                  |</span>
<span class="go">| dns_nameservers   | 2001:4860:4860::8844                                 |</span>
<span class="go">| enable_dhcp       | True                                                 |</span>
<span class="go">| gateway_ip        | fd00:203:0:113::1                                    |</span>
<span class="go">| ip_version        | 6                                                    |</span>
<span class="go">| ipv6_address_mode | slaac                                                |</span>
<span class="go">| ipv6_ra_mode      | None                                                 |</span>
<span class="go">| name              | provider1-v6                                         |</span>
<span class="go">+-------------------+------------------------------------------------------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Networking service uses the layer-3 agent to provide router
advertisement. Provider networks rely on physical network infrastructure
for layer-3 services rather than the layer-3 agent. Thus, the physical
network infrastructure must provide router advertisement on provider
networks for proper operation of IPv6.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="verify-network-operation">
<h3>Verify network operation<a class="headerlink" href="#verify-network-operation" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">On each compute node, verify creation of the <code class="docutils literal"><span class="pre">qdhcp</span></code> namespace.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> ip netns
<span class="go">qdhcp-8b868082-e312-4110-8627-298109d4401c</span>
</pre></div>
</div>
</li>
<li><p class="first">Source a regular (non-administrative) project credentials.</p>
</li>
<li><p class="first">Create the appropriate security group rules to allow <code class="docutils literal"><span class="pre">ping</span></code> and SSH
access instances using the network.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack security group rule create --proto icmp default
<span class="go">+------------------+-----------+</span>
<span class="go">| Field            | Value     |</span>
<span class="go">+------------------+-----------+</span>
<span class="go">| direction        | ingress   |</span>
<span class="go">| ethertype        | IPv4      |</span>
<span class="go">| protocol         | icmp      |</span>
<span class="go">| remote_ip_prefix | 0.0.0.0/0 |</span>
<span class="go">+------------------+-----------+</span>

<span class="gp">$</span> openstack security group rule create --ethertype IPv6 --proto ipv6-icmp default
<span class="go">+-----------+-----------+</span>
<span class="go">| Field     | Value     |</span>
<span class="go">+-----------+-----------+</span>
<span class="go">| direction | ingress   |</span>
<span class="go">| ethertype | IPv6      |</span>
<span class="go">| protocol  | ipv6-icmp |</span>
<span class="go">+-----------+-----------+</span>

<span class="gp">$</span> openstack security group rule create --proto tcp --dst-port <span class="m">22</span> default
<span class="go">+------------------+-----------+</span>
<span class="go">| Field            | Value     |</span>
<span class="go">+------------------+-----------+</span>
<span class="go">| direction        | ingress   |</span>
<span class="go">| ethertype        | IPv4      |</span>
<span class="go">| port_range_max   | 22        |</span>
<span class="go">| port_range_min   | 22        |</span>
<span class="go">| protocol         | tcp       |</span>
<span class="go">| remote_ip_prefix | 0.0.0.0/0 |</span>
<span class="go">+------------------+-----------+</span>

<span class="gp">$</span> openstack security group rule create --ethertype IPv6 --proto tcp --dst-port <span class="m">22</span> default
<span class="go">+------------------+-----------+</span>
<span class="go">| Field            | Value     |</span>
<span class="go">+------------------+-----------+</span>
<span class="go">| direction        | ingress   |</span>
<span class="go">| ethertype        | IPv6      |</span>
<span class="go">| port_range_max   | 22        |</span>
<span class="go">| port_range_min   | 22        |</span>
<span class="go">| protocol         | tcp       |</span>
<span class="go">+------------------+-----------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Launch an instance with an interface on the provider network. For example,
a CirrOS image using flavor ID 1.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack server create --flavor <span class="m">1</span> --image cirros <span class="se">\</span>
<span class="go">  --nic net-id=NETWORK_ID provider-instance1</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">NETWORK_ID</span></code> with the ID of the provider network.</p>
</li>
<li><p class="first">Determine the IPv4 and IPv6 addresses of the instance.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack server list
<span class="go">+--------------------------------------+--------------------+--------+------------------------------------------------------------+------------+</span>
<span class="go">| ID                                   | Name               | Status | Networks                                                   | Image Name |</span>
<span class="go">+--------------------------------------+--------------------+--------+------------------------------------------------------------+------------+</span>
<span class="go">| 018e0ae2-b43c-4271-a78d-62653dd03285 | provider-instance1 | ACTIVE | provider1=203.0.113.13, fd00:203:0:113:f816:3eff:fe58:be4e | cirros     |</span>
<span class="go">+--------------------------------------+--------------------+--------+------------------------------------------------------------+------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">On the controller node or any host with access to the provider network,
<code class="docutils literal"><span class="pre">ping</span></code> the IPv4 and IPv6 addresses of the instance.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ping -c <span class="m">4</span> 203.0.113.13
<span class="go">PING 203.0.113.13 (203.0.113.13) 56(84) bytes of data.</span>
<span class="go">64 bytes from 203.0.113.13: icmp_req=1 ttl=63 time=3.18 ms</span>
<span class="go">64 bytes from 203.0.113.13: icmp_req=2 ttl=63 time=0.981 ms</span>
<span class="go">64 bytes from 203.0.113.13: icmp_req=3 ttl=63 time=1.06 ms</span>
<span class="go">64 bytes from 203.0.113.13: icmp_req=4 ttl=63 time=0.929 ms</span>

<span class="go">--- 203.0.113.13 ping statistics ---</span>
<span class="go">4 packets transmitted, 4 received, 0% packet loss, time 3002ms</span>
<span class="go">rtt min/avg/max/mdev = 0.929/1.539/3.183/0.951 ms</span>

<span class="gp">$</span> ping6 -c <span class="m">4</span> fd00:203:0:113:f816:3eff:fe58:be4e
<span class="go">PING fd00:203:0:113:f816:3eff:fe58:be4e(fd00:203:0:113:f816:3eff:fe58:be4e) 56 data bytes</span>
<span class="go">64 bytes from fd00:203:0:113:f816:3eff:fe58:be4e icmp_seq=1 ttl=64 time=1.25 ms</span>
<span class="go">64 bytes from fd00:203:0:113:f816:3eff:fe58:be4e icmp_seq=2 ttl=64 time=0.683 ms</span>
<span class="go">64 bytes from fd00:203:0:113:f816:3eff:fe58:be4e icmp_seq=3 ttl=64 time=0.762 ms</span>
<span class="go">64 bytes from fd00:203:0:113:f816:3eff:fe58:be4e icmp_seq=4 ttl=64 time=0.486 ms</span>

<span class="go">--- fd00:203:0:113:f816:3eff:fe58:be4e ping statistics ---</span>
<span class="go">4 packets transmitted, 4 received, 0% packet loss, time 2999ms</span>
<span class="go">rtt min/avg/max/mdev = 0.486/0.796/1.253/0.282 ms</span>
</pre></div>
</div>
</li>
<li><p class="first">Obtain access to the instance.</p>
</li>
<li><p class="first">Test IPv4 and IPv6 connectivity to the Internet or other external network.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="network-traffic-flow">
<h2>Network traffic flow<a class="headerlink" href="#network-traffic-flow" title="Permalink to this headline">¶</a></h2>
<p>The following sections describe the flow of network traffic in several
common scenarios. <em>North-south</em> network traffic travels between an instance
and external network such as the Internet. <em>East-west</em> network traffic
travels between instances on the same or different networks. In all scenarios,
the physical network infrastructure handles switching and routing among
provider networks and external networks such as the Internet. Each case
references one or more of the following components:</p>
<ul class="simple">
<li>Provider network 1 (VLAN)<ul>
<li>VLAN ID 101 (tagged)</li>
<li>IP address ranges 203.0.113.0/24 and fd00:203:0:113::/64</li>
<li>Gateway (via physical network infrastructure)<ul>
<li>IP addresses 203.0.113.1 and fd00:203:0:113:0::1</li>
</ul>
</li>
</ul>
</li>
<li>Provider network 2 (VLAN)<ul>
<li>VLAN ID 102 (tagged)</li>
<li>IP address range 192.0.2.0/24 and fd00:192:0:2::/64</li>
<li>Gateway<ul>
<li>IP addresses 192.0.2.1 and fd00:192:0:2::1</li>
</ul>
</li>
</ul>
</li>
<li>Instance 1<ul>
<li>IP addresses 203.0.113.101 and fd00:203:0:113:0::101</li>
</ul>
</li>
<li>Instance 2<ul>
<li>IP addresses 192.0.2.101 and fd00:192:0:2:0::101</li>
</ul>
</li>
</ul>
<div class="section" id="north-south">
<h3>North-south<a class="headerlink" href="#north-south" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The instance resides on compute node 1 and uses provider network 1.</li>
<li>The instance sends a packet to a host on the Internet.</li>
</ul>
<p>The following steps involve compute node 1.</p>
<ol class="arabic simple">
<li>The instance interface (1) forwards the packet to the security group
bridge instance port (2) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
<li>Security group rules (3) on the security group bridge handle firewalling
and connection tracking for the packet.</li>
<li>The security group bridge OVS port (4) forwards the packet to the OVS
integration bridge security group port (5) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
<li>The OVS integration bridge adds an internal VLAN tag to the packet.</li>
<li>The OVS integration bridge <code class="docutils literal"><span class="pre">int-br-provider</span></code> patch port (6) forwards
the packet to the OVS provider bridge <code class="docutils literal"><span class="pre">phy-br-provider</span></code> patch port (7).</li>
<li>The OVS provider bridge swaps the internal VLAN tag with actual VLAN tag
101.</li>
<li>The OVS provider bridge provider network port (8) forwards the packet to
the physical network interface (9).</li>
<li>The physical network interface forwards the packet to the physical
network infrastructure switch (10).</li>
</ol>
<p>The following steps involve the physical network infrastructure:</p>
<ol class="arabic simple">
<li>The switch removes VLAN tag 101 from the packet and forwards it to the
router (11).</li>
<li>The router routes the packet from the provider network (12) to the
external network (13) and forwards the packet to the switch (14).</li>
<li>The switch forwards the packet to the external network (15).</li>
<li>The external network (16) receives the packet.</li>
</ol>
<img alt="Provider networks using Open vSwitch - network traffic flow - north/south" src="_images/deploy-ovs-provider-flowns1.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Return traffic follows similar steps in reverse.</p>
</div>
</div>
<div class="section" id="east-west-scenario-1-instances-on-the-same-network">
<h3>East-west scenario 1: Instances on the same network<a class="headerlink" href="#east-west-scenario-1-instances-on-the-same-network" title="Permalink to this headline">¶</a></h3>
<p>Instances on the same network communicate directly between compute nodes
containing those instances.</p>
<ul class="simple">
<li>Instance 1 resides on compute node 1 and uses provider network 1.</li>
<li>Instance 2 resides on compute node 2 and uses provider network 1.</li>
<li>Instance 1 sends a packet to instance 2.</li>
</ul>
<p>The following steps involve compute node 1:</p>
<ol class="arabic simple">
<li>The instance 1 interface (1) forwards the packet to the security group
bridge instance port (2) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
<li>Security group rules (3) on the security group bridge handle firewalling
and connection tracking for the packet.</li>
<li>The security group bridge OVS port (4) forwards the packet to the OVS
integration bridge security group port (5) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
<li>The OVS integration bridge adds an internal VLAN tag to the packet.</li>
<li>The OVS integration bridge <code class="docutils literal"><span class="pre">int-br-provider</span></code> patch port (6) forwards
the packet to the OVS provider bridge <code class="docutils literal"><span class="pre">phy-br-provider</span></code> patch port (7).</li>
<li>The OVS provider bridge swaps the internal VLAN tag with actual VLAN tag
101.</li>
<li>The OVS provider bridge provider network port (8) forwards the packet to
the physical network interface (9).</li>
<li>The physical network interface forwards the packet to the physical
network infrastructure switch (10).</li>
</ol>
<p>The following steps involve the physical network infrastructure:</p>
<ol class="arabic simple">
<li>The switch forwards the packet from compute node 1 to compute node 2 (11).</li>
</ol>
<p>The following steps involve compute node 2:</p>
<ol class="arabic simple">
<li>The physical network interface (12) forwards the packet to the OVS
provider bridge provider network port (13).</li>
<li>The OVS provider bridge <code class="docutils literal"><span class="pre">phy-br-provider</span></code> patch port (14) forwards the
packet to the OVS integration bridge <code class="docutils literal"><span class="pre">int-br-provider</span></code> patch port (15).</li>
<li>The OVS integration bridge swaps the actual VLAN tag 101 with the internal
VLAN tag.</li>
<li>The OVS integration bridge security group port (16) forwards the packet
to the security group bridge OVS port (17).</li>
<li>Security group rules (18) on the security group bridge handle firewalling
and connection tracking for the packet.</li>
<li>The security group bridge instance port (19) forwards the packet to the
instance 2 interface (20) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
</ol>
<img alt="Provider networks using Open vSwitch - network traffic flow - east/west scenario 1" src="_images/deploy-ovs-provider-flowew1.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Return traffic follows similar steps in reverse.</p>
</div>
</div>
<div class="section" id="east-west-scenario-2-instances-on-different-networks">
<h3>East-west scenario 2: Instances on different networks<a class="headerlink" href="#east-west-scenario-2-instances-on-different-networks" title="Permalink to this headline">¶</a></h3>
<p>Instances communicate via router on the physical network infrastructure.</p>
<ul class="simple">
<li>Instance 1 resides on compute node 1 and uses provider network 1.</li>
<li>Instance 2 resides on compute node 1 and uses provider network 2.</li>
<li>Instance 1 sends a packet to instance 2.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Both instances reside on the same compute node to illustrate how VLAN
tagging enables multiple logical layer-2 networks to use the same
physical layer-2 network.</p>
</div>
<p>The following steps involve the compute node:</p>
<ol class="arabic simple">
<li>The instance 1 interface (1) forwards the packet to the security group
bridge instance port (2) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
<li>Security group rules (3) on the security group bridge handle firewalling
and connection tracking for the packet.</li>
<li>The security group bridge OVS port (4) forwards the packet to the OVS
integration bridge security group port (5) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
<li>The OVS integration bridge adds an internal VLAN tag to the packet.</li>
<li>The OVS integration bridge <code class="docutils literal"><span class="pre">int-br-provider</span></code> patch port (6) forwards
the packet to the OVS provider bridge <code class="docutils literal"><span class="pre">phy-br-provider</span></code> patch port (7).</li>
<li>The OVS provider bridge swaps the internal VLAN tag with actual VLAN tag
101.</li>
<li>The OVS provider bridge provider network port (8) forwards the packet to
the physical network interface (9).</li>
<li>The physical network interface forwards the packet to the physical
network infrastructure switch (10).</li>
</ol>
<p>The following steps involve the physical network infrastructure:</p>
<ol class="arabic simple">
<li>The switch removes VLAN tag 101 from the packet and forwards it to the
router (11).</li>
<li>The router routes the packet from provider network 1 (12) to provider
network 2 (13).</li>
<li>The router forwards the packet to the switch (14).</li>
<li>The switch adds VLAN tag 102 to the packet and forwards it to compute
node 1 (15).</li>
</ol>
<p>The following steps involve the compute node:</p>
<ol class="arabic simple">
<li>The physical network interface (16) forwards the packet to the OVS
provider bridge provider network port (17).</li>
<li>The OVS provider bridge <code class="docutils literal"><span class="pre">phy-br-provider</span></code> patch port (18) forwards the
packet to the OVS integration bridge <code class="docutils literal"><span class="pre">int-br-provider</span></code> patch port (19).</li>
<li>The OVS integration bridge swaps the actual VLAN tag 102 with the internal
VLAN tag.</li>
<li>The OVS integration bridge security group port (20) removes the internal
VLAN tag and forwards the packet to the security group bridge OVS port
(21).</li>
<li>Security group rules (22) on the security group bridge handle firewalling
and connection tracking for the packet.</li>
<li>The security group bridge instance port (23) forwards the packet to the
instance 2 interface (24) via <code class="docutils literal"><span class="pre">veth</span></code> pair.</li>
</ol>
<img alt="Provider networks using Open vSwitch - network traffic flow - east/west scenario 2" src="_images/deploy-ovs-provider-flowew2.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Return traffic follows similar steps in reverse.</p>
</div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="deploy-ovs.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Open vSwitch mechanism driver"></i></a>
          
          
            <a href="deploy-ovs-selfservice.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Open vSwitch: Self-service networks"></i></a>
          
            <a id="logABugLink3" href="#" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2016-12-31 09:02</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org/" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='http://docs.openstack.org/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index-2.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="deploy.html">Deployment examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="deploy.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="deploy.html#mechanism-drivers">Mechanism drivers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ops.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org/">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org/">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org/">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com/" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.11.3.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "deploy-ovs-provider" + ".rst";
        gitURL = "Source: http://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/networking-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 8769323640f01e3e92c0a6af672b0e6fab8a4af7";
        var bugProject = "openstack-manuals";
        var bugTitle = "Open vSwitch: Provider networks in Networking Guide";
    var fieldTags = "networking-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.9 on 2016-12-31 09:02";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>

<!-- Mirrored from docs.openstack.org/newton/networking-guide/deploy-ovs-provider.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Jan 2017 11:09:51 GMT -->
</html>